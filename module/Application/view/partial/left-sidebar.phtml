<?php
use Application\Helper\Common;

//var_dump($this->routes);die;
$routeMatch = $this->getHelperPluginManager()->getServiceLocator()->get('Application')->getMvcEvent()->getRouteMatch();
$routeName = $routeMatch->getMatchedRouteName();

$currentRoute = explode('/', $routeName);
$currentSlug = $routeMatch->getParam('slug', null);
$parentRoute = (Common::getParentMenuFromSlug($currentSlug, $this->config('router'))) ?
    Common::getParentMenuFromSlug($currentSlug, $this->config('router')) :
    $currentRoute[0];
$routes = $this->config('router')['routes'][$parentRoute];
?>

<div class="list-group panel default-panel">
    <div class="panel-heading">
        <a href="<?php echo $this->url($parentRoute) ?>"
           title="<?php echo $this->translate(Common::getNameFromRoute($parentRoute)) ?>">
            <?php echo $this->translate(Common::getNameFromRoute($parentRoute)) ?>
        </a>
    </div>
    <?php
    foreach ($routes['child_routes'] as $k => $route) :
        $currentRoute = $parentRoute . '/' . $k;
        ?>
        <?php if (!isset($route['hide'])) :  // hide route on navigation ?>
        <a class="list-group-item<?php echo ($routeName == $currentRoute) ? ' active' : '' ?>"
           href="<?php echo $this->url($currentRoute) ?>"
           title="<?php echo $this->translate(Common::getNameFromRoute($route['options']['route'])) ?>">
            <?php echo $this->translate(Common::getNameFromRoute($route['options']['route'])) ?>
        </a>
        <?php endif; ?>
    <?php endforeach; ?>

    <!-- Custom pages were set in landing module config route -->
    <?php if (isset($routes['custom_links'])) : ?>
        <?php
        foreach ($routes['custom_links'] as $link) :
            $url =  (Locale::getPrimaryLanguage(Locale::getDefault()) == 'en') ? $link['link']['en'] : $link['link']['ar'];
            ?>
            <a class="list-group-item<?php echo ($currentSlug == $url) ? ' active' : '' ?>"
                href="<?php echo $this->url('blog/view', ['slug' => $url]) ?>">
                <?php echo $this->translate($link['label']) ?>
            </a>
        <?php endforeach; ?>
    <?php endif; ?>
</div>