<?php
use Application\Helper\Common;

$routeMatch = $this->getHelperPluginManager()->getServiceLocator()->get('Application')
    ->getMvcEvent()->getRouteMatch();
if ($routeMatch) {
    $routeName = $routeMatch->getMatchedRouteName();
} else {
    $routeName = '404';
}
$currentRoute = explode('/', $routeName);
$currentParentRoute = $currentRoute[0];
$parentRoute = $this->route;
$routes = $this->config('router')['routes'][$parentRoute];

?>
<li class="dropdown<?php echo ($currentParentRoute == $parentRoute) ? ' active current-menu-item' : '' ?>">
    <a data-toggle="dropdown" href="<?php echo $this->url($parentRoute) ?>">
        <?php echo $this->translate(Common::getNameFromRoute($parentRoute)) ?>
        <span class="caret"></span>
    </a>
    <ul class="dropdown-menu" role="menu">
        <?php
        foreach ($routes['child_routes'] as $k => $route) :
            $currentRoute = $parentRoute . '/' . $k;
            ?>
            <?php if (!isset($route['hide'])) :  // hide route on navigation ?>
            <li<?php echo ($routeName == $currentRoute) ? ' class="active"' : '' ?>>
                <a href="<?php echo $this->url($currentRoute) ?>">
                    <?php echo $this->translate(Common::getNameFromRoute($route['options']['route'])) ?>
                </a>
            </li>
            <?php endif; ?>
        <?php endforeach; ?>
    </ul>
</li>